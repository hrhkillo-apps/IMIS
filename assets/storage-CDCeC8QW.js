class f{constructor(){this.store=new Map}getItem(e){return this.store.get(e)||null}setItem(e,r){this.store.set(e,String(r))}removeItem(e){this.store.delete(e)}clear(){this.store.clear()}}const n=new f,S=t=>{const r=(()=>{try{const s=window[t],c="__storage_test__";return s.setItem(c,c),s.removeItem(c),!0}catch{return!1}})();return{getItem:s=>{if(r)try{return window[t].getItem(s)}catch{return n.getItem(s)}return n.getItem(s)},setItem:(s,c)=>{if(r)try{window[t].setItem(s,c)}catch{n.setItem(s,c)}else n.setItem(s,c)},removeItem:s=>{if(r)try{window[t].removeItem(s)}catch{n.removeItem(s)}else n.removeItem(s)},clear:()=>{if(r)try{window[t].clear()}catch{n.clear()}else n.clear()}}},o=S("localStorage");S("sessionStorage");const i={TICKET:"imis_history_ticket",FTR:"imis_history_ftr",REG:"imis_history_reg"},a=t=>[...t],m=t=>new Set(t),g={loadHistory:()=>{try{const t=o.getItem(i.TICKET),e=o.getItem(i.FTR),r=o.getItem(i.REG);return{ticket:t?m(JSON.parse(t)):new Set,ftr:e?m(JSON.parse(e)):new Set,reg:r?m(JSON.parse(r)):new Set}}catch(t){return console.error("Failed to load ID history:",t),{ticket:new Set,ftr:new Set,reg:new Set}}},saveBatch:t=>{try{const e=g.loadHistory();t.ticket.size>0&&(t.ticket.forEach(r=>e.ticket.add(String(r))),o.setItem(i.TICKET,JSON.stringify(a(e.ticket)))),t.ftr.size>0&&(t.ftr.forEach(r=>e.ftr.add(String(r))),o.setItem(i.FTR,JSON.stringify(a(e.ftr)))),t.reg.size>0&&(t.reg.forEach(r=>e.reg.add(String(r))),o.setItem(i.REG,JSON.stringify(a(e.reg))))}catch(e){console.error("Failed to save ID history:",e)}},exportHistoryData:()=>{const t=g.loadHistory();return{ticket:a(t.ticket),ftr:a(t.ftr),reg:a(t.reg),timestamp:new Date().toISOString()}},importHistoryData:t=>{try{const e=JSON.parse(t);if(!e.ticket||!e.ftr||!e.reg)throw new Error("Invalid format");const r=new Set(e.ticket),s=new Set(e.ftr),c=new Set(e.reg);return o.setItem(i.TICKET,JSON.stringify([...r])),o.setItem(i.FTR,JSON.stringify([...s])),o.setItem(i.REG,JSON.stringify([...c])),{success:!0,count:r.size+s.size+c.size}}catch(e){return{success:!1,error:e.message}}},clearHistory:()=>{o.removeItem(i.TICKET),o.removeItem(i.FTR),o.removeItem(i.REG)}};export{g as IDStorage};
