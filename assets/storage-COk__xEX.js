const r={TICKET:"imis_history_ticket",FTR:"imis_history_ftr",REG:"imis_history_reg"},a=t=>[...t],i=t=>new Set(t),n={loadHistory:()=>{try{const t=localStorage.getItem(r.TICKET),e=localStorage.getItem(r.FTR),o=localStorage.getItem(r.REG);return{ticket:t?i(JSON.parse(t)):new Set,ftr:e?i(JSON.parse(e)):new Set,reg:o?i(JSON.parse(o)):new Set}}catch(t){return console.error("Failed to load ID history:",t),{ticket:new Set,ftr:new Set,reg:new Set}}},saveBatch:t=>{try{const e=n.loadHistory();t.ticket.size>0&&(t.ticket.forEach(o=>e.ticket.add(String(o))),localStorage.setItem(r.TICKET,JSON.stringify(a(e.ticket)))),t.ftr.size>0&&(t.ftr.forEach(o=>e.ftr.add(String(o))),localStorage.setItem(r.FTR,JSON.stringify(a(e.ftr)))),t.reg.size>0&&(t.reg.forEach(o=>e.reg.add(String(o))),localStorage.setItem(r.REG,JSON.stringify(a(e.reg))))}catch(e){console.error("Failed to save ID history:",e),e.name==="QuotaExceededError"&&alert("Warning: Browser storage is full. ID history may not be saved!")}},exportHistoryData:()=>{const t=n.loadHistory();return{ticket:a(t.ticket),ftr:a(t.ftr),reg:a(t.reg),timestamp:new Date().toISOString()}},importHistoryData:t=>{try{const e=JSON.parse(t);if(!e.ticket||!e.ftr||!e.reg)throw new Error("Invalid format");const o=new Set(e.ticket),s=new Set(e.ftr),c=new Set(e.reg);return localStorage.setItem(r.TICKET,JSON.stringify([...o])),localStorage.setItem(r.FTR,JSON.stringify([...s])),localStorage.setItem(r.REG,JSON.stringify([...c])),{success:!0,count:o.size+s.size+c.size}}catch(e){return{success:!1,error:e.message}}},clearHistory:()=>{localStorage.removeItem(r.TICKET),localStorage.removeItem(r.FTR),localStorage.removeItem(r.REG)}};export{n as IDStorage};
