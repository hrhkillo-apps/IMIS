const E=(A,l,p)=>{if(!A||A.length===0)throw new Error("Commitment Accounts file is mandatory and cannot be empty.");const C=t=>String(t).trim().toLowerCase().replace(/[^a-z0-9]/g,""),y=(t,e)=>{const s=C(e);return Object.keys(t).find(r=>C(r).includes(s))},c=(t,e)=>{const s=y(t,e);return s?t[s]:void 0},g=t=>{const e=c(t,"Bill Amount")||c(t,"Net Amount")||c(t,"Amount")||c(t,"Payable")||0;return parseFloat(e)||0},m=new Map;l&&l.length>0&&l.forEach(t=>{let e=c(t,"Account Number")||c(t,"Beneficiary Account")||c(t,"Account");e&&m.set(String(e).trim(),t)});const T=new Map;p&&p.length>0&&p.forEach(t=>{let e=c(t,"Account Number")||c(t,"Beneficiary Account")||c(t,"Account");e&&T.set(String(e).trim(),t)});const h=[],u={};if(A.forEach(t=>{let e=c(t,"Account Number")||c(t,"Account")||c(t,"Acc No");if(e){const s=String(e).trim(),r=m.get(s),o=T.get(s);if(l?.length&&r||p?.length&&o){const d=c(t,"NAME OF THE VENDOR")||"Unknown Vendor";u[d]||(u[d]={proposedCount:0,proposedTotal:0,creditedCount:0,creditedTotal:0});let a=0,i=0;o&&(a=g(o),u[d].proposedCount+=1,u[d].proposedTotal+=a),r&&(i=g(r),u[d].creditedCount+=1,u[d].creditedTotal+=i),h.push({commRow:t,vendorName:d,proposedAmt:o?a:null,creditedAmt:r?i:null})}}}),h.length===0)throw new Error("No matches found. Check 'Account Number' columns.");h.sort((t,e)=>(t.vendorName||"").localeCompare(e.vendorName||""));const P=[],M=new Set;return h.forEach(({commRow:t,vendorName:e,proposedAmt:s,creditedAmt:r})=>{const o=u[e],f=!M.has(e);f&&M.add(e);const a=(o.creditedTotal>0?o.creditedTotal:o.proposedTotal)*.55,i={...t},n=(N,S)=>{const b=y(t,N);b?i[b]=S:i[N]=S};f?(n("Proposed Accounts count",o.proposedCount),n("Proposed Payment Vendor",o.proposedTotal),n("Total Accounts count",o.creditedCount||o.proposedCount),n("Total Accounts count",o.creditedCount>0?o.creditedCount:o.proposedCount),n("Credited Accounts count",o.creditedCount),n("Credited Payment Vendor",o.creditedTotal),n("My Share",a.toFixed(2))):(n("Total Accounts count",""),n("Proposed Accounts count",""),n("Credited Accounts count",""),n("Proposed Payment Vendor",""),n("Credited Payment Vendor",""),n("My Share","")),n("Proposed Payment Individual",s!==null?s:""),n("Credited Payment Individual",r!==null?r:""),P.push(i)}),P};export{E as processCommitments};
